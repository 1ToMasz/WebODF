<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>JavaScriptZip demo</title>
  <script src="bytearray.js" type="text/javascript" charset="utf-8"></script>
  <script src="zip.js" type="text/javascript" charset="utf-8"></script>
  <script src="rawinflate.js" type="text/javascript" charset="utf-8"></script>
  <script src="filelist.js" type="text/javascript" charset="utf-8"></script>
  <style type="text/css" media="screen">
    div { display: inline-block; }
    .box {
      position: relative;
      width: 100px;
      height: 100px;
      background-color: blue;
      -webkit-transition-property: -webkit-transform;
      -webkit-transition-duration: 5s;
      -webkit-transform: translate(0, 0);
    }

    .moved {
      -webkit-transform: translateX(300px);
    }
  </style>
  <script type="text/javascript" charset="utf-8">

    function showFile(e) {
      e.stopPropagation();
      var ziplist = document.getElementById('ziplist');
      ziplist.innerHTML = '';
      var preview = document.getElementById('preview');
      preview.innerHTML = '';
      var zip;
      try {
        zip = new jsodfkit.Zip(e.target);
      } catch (e) {
        ziplist.innerHTML = e;
        return false;
      }
      for (var i in zip.entries) {
        if (zip.entries[i].uncompressedSize > 0) {
          ziplist.appendChild(createZipEntry(zip, i));
          ziplist.appendChild(document.createElement('br'));
        }
      }
      return false;
    }

    function showEntry(e) {
      e.stopPropagation();
      var t = e.target;
      var l = '';//e.targetElement;
      for (var i in e.target) {
        l += i + ' ';
      }
      var preview = document.getElementById('preview');
      preview.innerHTML = '';
      try {
        var data = t.zipentry.load(t.zip.stream);
        preview.innerHTML = data;
      } catch (e) {
        preview.innerHTML = e + '<br/>' + t.localName + '<br/>' + l;
      }
      return false;
    }

    function createZipEntry(zip, i) {
      var a = document.createElement('a');
      a.zip = zip;
      a.zipentry = a.zip.entries[i];
      a.href = a.zip.uri + '/' + a.zipentry.filename;
      a.appendChild(document.createTextNode(a.zipentry.filename));
      a.onclick = showEntry;
      return a;
    }

    function createFileLink(path) {
      var a = document.createElement('a');
      a.href = path;
      a.appendChild(document.createTextNode(path));
      a.onclick = showFile;
      return a;
    }

    function fillList()
    {
      var body = document.getElementById('list');
      for (var f in fileList) {
        body.appendChild(createFileLink(fileList[f]));
        body.appendChild(document.createElement('br'));
      }
    }
  </script>
</head>
<body id='body' onload="fillList()">
<div id='list'></div>
<div id='ziplist'></div>
<div id='preview'></div>
</body>
</html>
